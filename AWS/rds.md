# RDS

## 1. 관계형 데이터 베이스 (RDBMS)

- 데이터 간의 **관계**에 집중한 데이터베이스이다.
- 사전에 정의된 **형식**과 **타입**의 데이터만 저장 가능하다.
- 행(Row)과 열(Column)로 구성된 **테이블** 형식으로 데이터를 관리한다.
- **고유의 키(Primary Key)**로 각 데이터를 식별한다.
- **트랜잭션**을 지원하여 데이터의 무결성을 보장한다(모두 성공하거나, 모두 실패하거나).

## 2. Amazon RDS(Relational Database Service)

- 클라우드에서 관계형 데이터베이스를 간편하게 설정, 운영 및 확장할 수 있는 **관리형 서비스**이다.
- 하드웨어 프로비저닝, 데이터베이스 설정, 패치 및 백업과 같은 시간 소모적인 관리 작업을 **자동화**해 준다.
- 사용자가 인프라 관리가 아닌 **애플리케이션 개발**에 집중할 수 있도록 지원한다.
- **가상 머신** 위에서 동작하지만, 사용자가 OS에 직접 로그인할 수 없다(AWS가 관리).
- **Serverless** 서비스가 아니다.
  - **Aurora Serverless**는 예외이다.
- **암호화** 및 **자동 백업**을 지원한다.

### 2.1. RDS와 EC2

- 내부적으로 **EC2** 인스턴스를 활용하여 동작한다.
- **VPC** 내부에서 동작하며, 기본적으로 외부 접근이 차단되지만 설정에 따라 **Public IP**를 부여하여 접근 가능하다.
- **서브넷**과 **보안 그룹** 지정이 필요하다.
- **EC2 타입** 지정이 필요하며, 스토리지는 **EBS**를 활용한다.
- **일시 중지**가 가능하지만, 최대 **7일** 후에 자동으로 다시 시작된다.
- 백업을 위한 **스냅샷** 생성이 가능하다.
- **예약 인스턴스(Reserved Instance)**를 활용하여 비용 할인이 가능하다.

### 2.2. RDS 인증 방법

- 전통적인 **ID/Password** 방식을 지원하며, **AWS Secrets Manager**와 연동하여 자동 로테이션이 가능하다.
- **IAM DB 인증**을 통해 IAM 역할로 데이터베이스 접근 관리가 가능하다.
- **Kerberos 인증**을 지원한다.

### 2.3. RDS에서 제공하는 DB 엔진

- **상용 엔진**: **Oracle**, **MS SQL Server**, **IBM Db2** (라이선스 비용 추가)
- **오픈 소스 엔진**: **MySQL**, **PostgreSQL**, **MariaDB**
- **클라우드 네이티브**: **Amazon Aurora**

### 2.4. RDS Multi AZ (다중 가용 영역)

- 두 개 이상의 **AZ**에 걸쳐 데이터베이스를 구축하고 원본과 **Standby DB**를 자동으로 **동기화(Sync)**한다.
- 원본 DB 장애 발생 시 자동으로 Standby DB가 **승격(Failover)**된다(DNS가 Standby DB를 가리킴).
- Standby DB는 평소에 **접근 불가능**하다.
- 성능 향상이 아닌 **고가용성(안정성)**을 위한 기능이다.

### 2.5. 읽기 전용 복제본 (Read Replica)

- 데이터베이스의 **읽기 전용 복제본**을 생성하며 **비동기(Async)** 방식을 사용한다.
- 쓰기는 원본, 읽기는 복제본에서 처리하여 **워크로드 분산**이 가능하다.
- 안정성이 아닌 **성능 향상**을 위한 기능이다.
- 원본 DB 장애 발생 시 **수동**으로 승격 및 DNS 변경이 필요하다.

### 2.6. RDS Multi Region

- 다른 리전에 지속적으로 동기화시키는 **DB 클러스터**를 생성한다(비동기 복제).
- 주로 **로컬 성능** 확보 혹은 **재해 복구(DR)** 시나리오로 활용한다.

### 2.7. DB Subnet Group

- RDS가 위치할 **서브넷**들을 묶은 논리적 그룹이다.
- 보안을 위해 주로 **프라이빗 서브넷**으로 구성한다.
- 최소 **두 개 이상**의 가용 영역(AZ)에 속한 서브넷이 필요하다.
- 퍼블릭 접근을 허용하려면 **퍼블릭 서브넷**으로 구성해야 한다.

### 2.8. Parameter Group

- 데이터베이스의 주요 설정값(**Timezone**, **Character Set** 등)을 묶은 **논리적 단위**이다.
- 미리 정의해 둔 설정을 여러 RDS 인스턴스에 일괄 **적용** 가능하다.

## 3. RDS 접속

- RDS 생성 시 두 종류의 **IP**가 할당된다.
  - **Private IP**
    - 기본적으로 할당되며, VPC 내부의 리소스가 접근하기 위해 사용한다.
    - DB 인스턴스가 위치한 **서브넷**에 따라 Range가 결정된다.
  - **Public IP**
    - 퍼블릭 접근 옵션을 선택했을 때 할당된다.
    - 단, **Private 서브넷**에 DB 인스턴스가 있을 경우 할당되지 않는다.
- RDS의 **IP**는 다양한 상황(중지 후 재시작, 교체, 점검, OS 패치, 엔진 업데이트 등)에서 **변경**될 수 있다.
  - 따라서 가능하면 **DNS**로 접근하는 것이 좋다.
- 일반적으로 **Production DB**는 보안을 위해 **프라이빗 서브넷**에 배치한다.

### 3.1. 프라이빗 서브넷 접속 방법

- **Bastion Host**를 통해 접속 가능하다.
- **Instance Connect Endpoint**를 활용할 수 있다(무료). 단, 포트 활용에 제약이 있을 수 있다(예: 2289/3389 포트 등).
- **VPN** 또는 **Direct Connect**로 VPC와 연결하여 접속한다.

## 4. RDS 인증

- 일반적인 **Username/Password** 방식이다. **AWS Secrets Manager**와 연동하여 관리 가능하다.
- **IAM 인증** 방식이다.
  - IAM을 활용해 **임시 토큰**을 생성하여(유효기간 15분) RDS에 접속하는 방법이다.
  - DB 내부에 IAM 인증을 허용할 유저를 **등록**해야 한다.
  - 토큰 생성을 위해서는 `rds-db:connect` **권한**이 필요하다.
  - **IAM Condition**을 활용하여 세밀한 제어(특정 태그, IP, 시간대 등)가 가능하다.
- **Kerberos 인증**을 지원한다.
