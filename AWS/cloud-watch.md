# CloudWatch

## 1. CloudWatch

- DevOps 엔지니어, 개발자, SRE(사이트 안정성 엔지니어) 및 IT 관리자를 위해 구축된 **모니터링** 및 **관찰 기능** 서비스이다.
- 애플리케이션을 모니터링하고 시스템 전반의 성능 변경 사항에 대응하며, 리소스 사용률을 최적화하고 운영 상태에 대한 **통찰력**을 제공한다.
- AWS에서 제공하는 **애플리케이션 모니터링 서비스**이다.
- **Public 서비스**로, 인터넷을 통해 접근하거나 **Interface Endpoint**를 통해 접근 가능하다.
- 로그, 지표, 이벤트 등의 운영 데이터를 수집하여 **시각화** 및 **처리**한다.
- **경보 생성**을 통해 자동화된 대응이 가능하다.
- AWS의 거의 대부분의 서비스와 기본적으로 **연동**된다.

## 2. 지표(Metric)

- 시간 순서로 정리된 **데이터의 집합**으로, 다수의 **데이터 포인트**로 구성된다.
- AWS의 대부분의 서비스는 기본적으로 **지표**를 제공한다(예: EC2 CPU 사용량, 네트워크 등).
- **커스텀 지표** 생성이 가능하다.
  - 유저가 직접 원하는 데이터 포인트를 생성해서 CloudWatch로 전달한다
  - 예: EC2 메모리 사용량 등
- **리전 단위**로 동작한다.
- 데이터는 **15개월**간 보관되며, 지속적으로 새로운 데이터가 들어오면 15개월 이전 데이터는 사라지는 형식이다.

### 2.1. 데이터 포인트(Data Point)

- 지표를 구성하는 **시간**과 **값**의 데이터 단위이다.
  - 시간은 **초 단위**까지 기록된다.
- 내부적인 통계 및 알람 처리를 위해 **UTC 기준** 사용이 권장된다.

#### 데이터 포인트 Resolution

- 데이터가 얼마나 **자주 수집**되는지를 나타내는 개념이다.
- 기본적으로 **60초 단위**로 수집한다(Standard Resolution).
- **High Resolution** 모드에서는 **1초 단위**로 수집 가능하다.
- 조회 시 초 단위로 1, 5, 10, 30 혹은 60의 **배수**로 조회가 가능하다.

#### 데이터 포인트 기간(Period)

- 데이터가 얼마만큼의 시간을 기준으로 **묶여서(Aggregation)** 보이는지에 관한 개념이다.
- 최소 **1초**에서 최대 **86400초(1일)** 까지 설정 가능하다.
  - **60초 미만**은 **High-Resolution** 모드의 데이터만 가능하다.
- **보관 기간**에 따라 데이터의 해상도가 달라진다.
  - **60초 미만**: 최대 **3시간** 확인 가능하다.
  - **60초(1분)**: **15일** 확인 가능하다.
  - **300초(5분)**: **63일** 확인 가능하다.
  - **3600초(1시간)**: **455일(15개월)** 확인 가능하다.
- 작은 단위의 데이터는 시간이 지나면 큰 단위로 **자동 통합**된다.
  - 1분 단위 데이터는 15일이 지나면 5분 단위로, 63일이 지나면 1시간 단위로만 확인 가능하다.
- 2주 이상 업데이트되지 않은 Metric은 콘솔에서 보이지 않으며, CLI를 통해서만 확인 가능하다.

### 2.2. 네임스페이스(Namespace)

- CloudWatch 지표의 **컨테이너**이다.
- 지표의 출처 혹은 성격에 따라 논리적으로 묶은 **단위**이다.
- AWS 기본 지표는 `AWS/서비스명` 형식을 따른다(예: `AWS/EC2`, `AWS/RDS`).
- **필수 항목**이며 기본값이 없으므로 반드시 직접 명시해야 한다.

### 2.3. 지표 이름(Metric Name)

- 지표의 **고유 이름**이다.
- 무엇에 관한 지표인지 나타내며 **필수 항목**이다.

### 2.4. 차원(Dimensions)

- 지표를 구분할 때 사용하는 일종의 **태그/카테고리**이다.
- **Key-Value** 쌍으로 구성되며 최대 **30개**까지 할당 가능하다.
- 예: `AWS/EC2` 네임스페이스에 모든 EC2 지표가 수집되면, **InstanceID** 차원을 통해 개별 인스턴스를 구분해서 확인한다.

### 2.5. 기타

- 지표 시각화: 지표들을 확인하고 적절한 그래프로 시각화가 가능하며, 비교 분석할 수 있다.
- Metric Insight: 지표를 SQL 형식으로 조회하고 통합하여 분석할 수 있는 기능이다. 자연어로 쿼리 생성도 가능하다.

## 3. 경보(Alarm)

- 수집된 지표 값의 변동에 따라 발생하는 **알림**을 생성한다.
- 일정 수치(**Threshold**)에 도달하거나 이상/이하일 때 이벤트가 발생한다.
- 다양한 방법으로 **대응**이 가능하다.
  - **SNS**로 Lambda 실행, 이메일 전달 등이 가능하다.
  - 예: 웹 서버의 **500 에러**가 일정 수치 이상일 때 슬랙 알림을 전송한다.

## 4. 로그 수집 및 관리

- **Lambda**, **EC2**, **Route53**, **ECS** 등 여러 AWS 서비스의 **로그**를 수집한다.
- 수집된 로그를 **Kinesis**, **S3** 등 다른 서비스나 계정으로 **전달** 가능하다.
- 자체적으로 확인하거나 **쿼리**가 가능하다.

## 5. 대시보드

- 수집한 **로그/지표**를 기반으로 **대시보드**를 구성한다.
- 외부 리소스를 활용해서 **커스텀 대시보드** 구성이 가능하다.
  - **S3 객체** 표시, **HTML** 커스텀 그래프 표시 등을 지원한다.

## 6. 기타 서비스

- 애플리케이션을 모니터링하는 **Synthetics Canary**가 있다.
- 애플리케이션, 컨테이너, Lambda 등의 문제를 찾아주는 **인사이트 서비스** 등이 있다.

## 7. CloudWatch 요금

- 프리 티어(월)
  - **기본 모니터링 지표** 및 **커스텀 지표** 10개
  - **대시보드** 3개
  - **경보** 10개
  - **5GB**의 로그 데이터 등
- **요금** 부과 항목
  - **로그** 저장 비용, 분석 비용, **Live Tail** 비용 등이 발생한다.
  - **지표 개수**에 따라 비용이 발생한다.
  - **경보 개수**에 따라 비용이 발생한다.
  - 기타 **대시보드**, **모니터링**, **분석** 등 사용 서비스당 비용이 발생한다.
