# 단위 테스트

## 1. TDD 법칙 세 가지

1. **실패하는 단위 테스트를 작성할 때까지 실제 코드를 작성하지 않는다**.
2. **컴파일은 실패하지 않으면서 실행이 실패하는 정도로만 단위 테스트를 작성한다**.
3. **현재 실패하는 테스트를 통과할 정도로만 실제 코드를 작성한다**.

- 위 세 가지 규칙을 지키면 개발과 테스트가 대략 30초 주기로 묶인다.
- 테스트 코드와 실제 코드가 함께 나오며, 테스트 코드가 실제 코드보다 몇 초 먼저 나온다.
- 실제 코드와 맞먹을 정도로 방대한 테스트 코드는 **심각한 관리 문제**를 유발할 수 있다.

## 2. 깨끗한 테스트 코드 유지하기

- **지저분한 테스트 코드는 테스트를 안 하는 것보다 더 나쁜 결과**를 초래할 수 있다.
- 실제 코드가 진화하면 테스트 코드도 함께 진화해야 한다.
- 테스트 코드가 복잡해질수록 변경 비용이 커진다.
- 테스트 코드가 없으면 **개발자가 수정한 코드가 정상 동작하는지 확인할 방법이 없다**.
- **테스트 코드는 실제 코드만큼 중요하다**.

### 2.1 테스트는 유연성, 유지보수성, 재사용성을 제공한다

- 테스트 코드를 깨끗하게 유지하지 않으면 **테스트 코드를 잃게 되고**, 코드 유연성도 잃는다.
- 자동화된 단위 테스트는 **설계와 아키텍처를 최대한 깨끗하게 보존하는 열쇠**이다.

## 3. 깨끗한 테스트 코드

- **가독성**이 핵심이다.
- 테스트 코드에서 가독성을 높이려면 **명료성, 단순성, 풍부한 표현력**이 필요하다.
- 최소한의 표현으로 많은 의미를 전달해야 한다.
- **BUILD-OPERATE-CHECK 패턴**을 사용하자:
  - Build: 테스트 데이터를 준비
  - Operate: 테스트 대상을 실행
  - Check: 결과를 검증

### 3.1 도메인에 특화된 테스트 언어

- 테스트에 특화된 유틸리티 함수나 도메인 언어를 만들어 테스트 코드를 더 읽기 쉽게 만든다.

### 3.2 이중 표준

- 테스트 코드에는 **실제 코드와 다른 기준**이 적용된다.
- 간결함과 표현력이 중요하며, **메모리나 CPU 효율은 크게 중요하지 않다**.

## 4. 테스트당 assert 하나?

- JUnit에서는 테스트당 `assert`를 하나만 사용하라고 주장하는 의견이 있다.
- 하지만 테스트 분리로 인해 **중복이 많아지고 관리가 더 어려워질 수 있다**.
- 이를 **Template Method 패턴**이나 공통 `@Before` 설정으로 해결할 수 있으나 오히려 복잡해질 수 있다.
- 따라서 **assert는 여러 개 사용해도 되지만**, 테스트 함수는 **하나의 개념만 테스트**해야 한다.

### 4.1 테스트당 개념 하나

- 테스트 함수 하나가 **하나의 개념만 검증**해야 테스트가 명확하다.
- 여러 개념을 혼합해 테스트하면 **문제가 생겼을 때 원인을 파악하기 어렵다**.

## 5. F.I.R.S.T

### 5.1 Fast (빠르게)

- 테스트는 **항상 빠르게 실행**되어야 한다.
- 느린 테스트는 자주 실행되지 않고, 이는 오류를 조기에 발견하지 못하게 만든다.

### 5.2 Independent (독립적으로)

- 테스트는 **서로 의존하면 안 된다.**
- 실행 순서에 따라 테스트 결과가 달라지는 일이 없어야 한다.

### 5.3 Repeatable (반복 가능하게)

- 테스트는 **어떤 환경에서도 반복 실행 가능**해야 한다.
- 실제 서버든 로컬이든 QA 환경이든, 동일하게 동작해야 한다.

### 5.4 Self-Validating (자가 검증)

- 테스트는 **성공/실패를 자동으로 판단**해야 한다.
- 로그를 수동으로 확인해야 하는 테스트는 잘못된 테스트다.

### 5.5 Timely (적시에)

- 테스트는 **실제 코드를 구현하기 전에 작성**해야 한다.
- 코드를 먼저 만들고 테스트를 작성하면 **테스트하기 어려운 구조**가 만들어질 수 있다.

## 6. 마무리

- 테스트 코드는 **프로젝트의 건강을 좌우하는 핵심 자산**이다.
- 실제 코드보다 더 중요할 수도 있다.
- 테스트 코드는 **지속적으로 관리**되어야 하며, **가독성**, **간결성**, **표현력**을 갖춰야 한다.
