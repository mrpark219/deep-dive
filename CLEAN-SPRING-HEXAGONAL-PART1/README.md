# 토비의 클린 스프링 - 도메인 모델 패턴과 헥사고날 아키텍처 Part 1

## 1. 도메인 모델

- **도메인(Domain)** 이란, 소프트웨어가 해결하고자 하는 **특정 주제 영역 또는 문제 영역**이다.
- 소프트웨어는 이러한 도메인을 반영해야 하는데, 현실 세계의 도메인을 코드로 직접 옮길 수는 없다. 따라서 도메인을 추상화한 **도메인 모델**을 만들어야 한다.
- 도메인 모델은 특정 문제 영역의 **핵심 지도**와 같다. 이는 도메인에 존재하는 **중요한 개념과 규칙, 그리고 이들 사이의 관계를 표현**하는 것이다.

## 2. 도메인 주도 설계 (DDD)

- **도메인 주도 설계(DDD, Domain-Driven Design)** 는 복잡한 도메인의 문제를 해결하기 위한 접근법으로, **도메인 모델을 개발 과정의 중심에 두는 것**이다.
- DDD에서는 개발자뿐만 아니라, 도메인 전문가와 이해관계자 등 **모두가 함께 참여**하여 도메인 모델을 만들고 지속적으로 발전시킨다.
- DDD의 핵심 사상은 다음과 같다.
  - **모델 주도 설계 (Model-Driven Design)**: 도메인 모델이 실제 설계와 코드까지 일관되게 이어져야 한다.
  - **보편 언어 (Ubiquitous Language)**: 팀 안에서 도메인 모델에 기반한 단일 어휘 체계를 만들고, 이를 회의, 문서, 코드 등 모든 곳에서 일관되게 사용해야 한다.

## 3. 도메인 모델 만들기

- **1. 듣고 배우기**
  - 도메인 전문가(domain expert)의 설명을 통해 **도메인에 대한 지식을 습득**하는 단계이다.
- **2. 핵심 개념 식별**
  - 설명에서 드러나는 **핵심적인 개념과 단어(용어)들을 식별**하는 단계이다.
- **3. 관계 정의**
  - 앞에서 식별한 **개념들 사이의 연결고리, 즉 관계를 정의**하는 단계이다.
- **4. 속성 및 행위 명시**
  - 각 개념이 가지는 **핵심적인 속성(데이터)과 기본 행위(기능)를 명시**하는 단계이다.
- **5. 시각화**
  - 개념들 사이의 관계를 **그림으로 도식화하여 모델을 가시적으로 표현**하는 단계이다.
- **6. 반복하며 다듬기**
  - 완성된 모델을 바탕으로 **전문가와 다시 이야기하며 지속적으로 모델을 다듬고 발전**시키는 단계이다.

## 4. 도메인 전문가가 없다면

- **가상 도메인 전문가 활용**
  - 창업가, 기획자, PO(Product Owner) 등 **비즈니스에 대한 이해도가 가장 높은 사람**을 가상의 도메인 전문가로 삼아 협력하는 것이다.
- **집단적 학습**
  - **이벤트 스토밍(Event Storming)** 과 같은 워크숍을 통해, 여러 이해관계자가 모여 함께 도메인을 탐색하고 학습하는 것이다.
- **가설 기반의 점진적 모델링**
  - 처음부터 완벽한 모델을 추구하는 대신, **가설을 세우고 빠르게 프로토타입을 만들어 검증**하며 점진적으로 모델을 발전시키는 것이다.
- **보편 언어의 의식적 구축**
  - 팀 내에서 사용하는 용어를 **의식적으로 통일하고, 문서를 통해 공유**하며 보편 언어(Ubiquitous Language)를 점진적으로 만들어 나가는 것이다.
- **초기 사용자와의 적극적인 소통**
  - 베타 테스터나 초기 사용자들의 피드백을 통해 **실제 사용자의 관점에서 도메인을 이해**하고 모델을 개선하는 것이다.
- **경쟁 서비스 분석**
  - 경쟁 업체의 서비스를 분석하여, 해당 **도메인의 일반적인 기능과 용어를 학습**하는 것이다.
- 결론적으로, 도메인 전문가가 없는 환경에서는 도메인 모델을 **더욱 적극적으로 공유하고 지속적으로 발전**시키려는 노력이 훨씬 더 중요하다.

## 5. 엔티티(Entity)

- 도메일 모델을 만들 떄 사용하는 패턴
- 도메인 안에 있는 대상이나 개념
- 고유한 식별자(identity)를 가지고 이를 통해서 개별적으로 구분된다
- 생명주기(life cycle)를 가진다. 시간의 흐름에 따라 상태가 변경될 수 있다.

## 6. 도메인 모델 패턴

### 6.1. 도메인 모델 패턴 (Domain Model Pattern)

- **도메인 모델 패턴**은 도메인의 비즈니스 로직을 구성하는 아키텍처 패턴의 한 종류이다.
- 이 패턴은 도메인의 **데이터(속성)와 기능(행위)을 모두 가진 객체 모델**을 만드는 것이 특징이다.
- 객체 모델을 기반으로 하므로, **복잡한 연관 관계, 상속 등 객체지향의 장점을 활용**하여 도메인을 풍부하게 표현할 수 있다.

### 6.2. 트랜잭션 스크립트 패턴 (Transaction Script Pattern)

- **트랜잭션 스크립트 패턴**은 하나의 업무 절차(트랜잭션)를 처리하기 위한 **단일 메서드(스크립트)** 를 만드는 방식이다.
- 이 메서드 안에서 **필요한 비즈니스 로직을 순서대로 코드로 작성**하며, 주로 절차적인 방식으로 구현된다.
- 도메인 모델 패턴에 비해, **단순한 비즈니스 로직을 빠르고 간단하게 구현**할 때 주로 사용된다.

## 7. 값 객체 (Value Object)

- 도메인 모델에서 **고유한 식별자(ID) 없이, 오직 속성(값)만으로 구별**되는 객체를 **값 객체(Value Object)**라고 한다.
- 값 객체는 다음과 같은 특징과 장점을 가진다.
  - **책임 분리**: 특정 속성과 관련된 행위를 값 객체로 분리하여, **엔티티가 핵심 책임에만 집중**하도록 돕는다.
  - **개념 명시**: `String`과 같은 원시 타입보다 **'Email', 'Money'와 같이 도메인 개념을 더 명시적**으로 나타내어 모델의 명확성을 높인다.
  - **불변성(Immutability)**: 생성된 이후에는 상태가 변하지 않는다. 변경이 필요하면 **새로운 객체로 교체**해야 한다.
  - **풍부한 기능**: 관련된 **비즈니스 로직(행위)을 자신의 메서드로** 가질 수 있다.
  - **자체 유효성 검사**: 생성 시점에 **스스로 자신의 유효성을 검사**하는 로직을 포함할 수 있다.

### 7.1. 원시 타입 포장 (Wrap Primitive Type)

- **원시 타입 포장**은 `String`, `int`와 같은 원시 타입의 남용을 개선하고, **코드의 명시성과 안정성을 높이는 리팩터링 기법**이다.
- 이는 단순한 값을 **도메인의 핵심 구성요소인 값 객체로 만들어**, 값 자체의 의미와 불변성, 동등성 비교와 같은 도메인 로직을 포함하도록 설계하는 방식이다.

## 8. 도메인 모델 패턴의 두 가지 스타일

- **단순한 도메인 모델 (Simple Domain Model)**
  - 데이터베이스 테이블 구조와 유사하게, **하나의 테이블에 하나의 도메인 객체를 매핑**하는 방식이다. 구현이 단순하고 직관적인 장점이 있다.
- **풍성한 도메인 모델 (Rich Domain Model)**
  - 상속, 전략 패턴(Strategy Pattern) 등 **다양한 디자인 패턴을 적용**하여 복잡한 로직을 표현하는 방식이다. 도메인을 풍부하게 표현할 수 있지만, 데이터베이스 매핑이 어려워질 수 있다.

## 9. 도메인 로직의 API 개발

- 도메인 모델 패턴은 객체들의 상호작용으로 로직이 구현되므로, 트랜잭션 스크립트 패턴처럼 **명확한 작업 단위(Use Case)를 API로 제공하기가 어렵다**.
- 따라서, 도메인 모델 위에서 **명확한 작업 단위 API를 제공하는 애플리케이션 서비스(Application Service)** 계층이 별도로 필요하다.
