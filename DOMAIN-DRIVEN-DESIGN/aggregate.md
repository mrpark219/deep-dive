# 애그리거트

## 1. 애그리거트

- 수백 개의 테이블을 한 장의 ERD에 모두 표시하면 개별 관계에 집중하느라 큰 틀의 데이터 구조를 놓치기 쉽다.
- 마찬가지로 도메인 모델이 복잡해지면, 개발자는 개별 객체 위주로 모델을 보게 되어 **전체적인 구조나 상위 수준의 관계를 파악하기 어려워진다**.
- 이처럼 큰 그림을 이해하지 못하면, **요구사항 변경 및 확장에 소극적으로 대처**하게 되고 코드 수정을 회피하려는 경향이 생길 수 있다.
- 이러한 복잡성을 해결하고 상위 수준에서 모델을 조망하기 위한 방법이 바로 **애그리거트(Aggregate)** 이다.
- 애그리거트는 **서로 연관된 객체들을 하나의 군집으로 묶어주는 역할**을 한다. 수많은 객체를 애그리거트 단위로 묶어서 바라보면, 상위 수준에서 도메인 모델 간의 관계를 쉽게 파악할 수 있다.
- 애그리거트는 단순히 모델을 이해하는 데 도움을 줄 뿐만 아니라, **데이터의 일관성을 관리하는 기준**이 되기도 한다.
- 결론적으로 애그리거트는 복잡한 도메인을 더 단순한 구조로 만들어 주며, 이를 통해 **도메인 기능을 확장하고 변경하는 데 필요한 노력을 줄여준다**.

### 1.1. 애그리거트 설계 지침

- 애그리거트의 경계를 정하는 기준은 **도메인 규칙과 요구사항**이다. 'A가 B를 소유한다'는 관계가 있다고 해서 A와 B가 **반드시 하나의 애그리거트에 속하는 것은 아니다**.
- 예를 들어 제품과 리뷰라는 두 엔티티가 있을 때 제품과 리뷰가 한 애그리거트에 속한다고 생각할 수 있다. 하지만 두 엔티티는 함께 생성되거나 변경되지 않고, 변경 주체도 다르기 때문에 서로 다른 애그리거트에 속한다.
- 애그리거트는 **독립적인 객체 군집**이다. 각 애그리거트는 자기 자신을 관리할 뿐, 다른 애그리거트를 관리하지 않는다.
- 처음에는 애그리거트를 크게 설계하는 경향이 있지만, **도메인을 깊이 이해할수록 애그리거트의 크기는 작아지는 경우가 많다**. 실제로 다수의 애그리거트는 하나의 엔티티만으로 구성되기도 한다.
- 한 애그리거트에 속한 객체들은 **유사하거나 동일한 라이프사이클**을 가지는 경우가 많다.
