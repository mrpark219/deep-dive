# 리포지터리와 모델 구현

## 1. JPA를 이용한 리포지터리 구현

- 도메인 모델과 리포지터리를 구현할 때 많은 개발자들이 선호하는 기술은 **JPA**이다.
- RDBMS를 데이터 저장소로 사용할 때, 객체 기반의 도메인 모델과 관계형 데이터 모델 간의 불일치를 해결해주는 **ORM(Object-Relational Mapping)** 기술이 매우 유용하기 때문이다.

### 1.1. 모듈 위치

- **리포지터리 인터페이스**는 애그리거트와 함께 **도메인 영역**에 속하고, 이를 구현한 클래스는 **인프라스트럭처 영역**에 속하는 것이 이상적이다.
- 팀 표준에 따라 구현체를 `domain.impl`과 같은 패키지에 두는 경우도 있지만, 이는 좋은 설계 원칙을 따르기보다는 분리의 편의를 위한 **타협안에 가깝다**.
- 가능하다면 구현 클래스를 인프라스트럭처 영역에 명확히 위치시켜, **도메인이 인프라스트럭처에 대한 의존을 갖지 않도록** 설계해야 한다.

### 1.2. 리포지터리 기본 기능 구현

- 리포지터리가 기본적으로 제공하는 기능은 크게 두 가지이다.
  - **ID로 애그리거트 조회하기**
  - **애그리거트 저장하기**
- **조회 기능**의 이름에 정해진 규칙은 없지만, `findById()` 또는 `findBy프로퍼티이름()` 형식을 널리 사용한다.
- **저장 기능**을 담당하는 `save()` 메서드는 전달받은 애그리거트를 저장소에 영속화한다.
- JPA를 사용하면, 애그리거트를 수정한 결과를 반영하기 위해 별도의 `update` 메서드를 만들 필요가 없다.
- 트랜잭션이 커밋될 때, JPA는 트랜잭션 범위 내에서 **변경된 객체를 감지하여 자동으로 UPDATE 쿼리를 실행**해주기 때문이다. 이를 **더티 체킹(Dirty Checking)** 이라고 한다.
