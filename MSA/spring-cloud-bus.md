# Spring Cloud Bus

## 1. 설정 파일 변경

- 설정을 수정한 뒤 반영하는 방법은 다음과 같다.

1. 서버 재기동
   - 가장 단순한 방법으로, 변경된 설정을 적용할 수 있지만 다운타임이 발생한다.
2. Actuator의 `/actuator/refresh` 호출
   - 수동으로 애플리케이션의 설정을 런타임 중에 갱신할 수 있다.
3. Spring Cloud Bus 사용
   - 메시지 브로커(RabbitMQ, Kafka 등)를 통해 설정 변경 사항을 **모든 인스턴스에 자동으로 전파**할 수 있다.
   - 분산 시스템의 노드를 메시지 브로커에 연결하여 상태 및 구성 변경 사항을 **브로드캐스트**한다.

## 2. Spring Cloud Bus

- Spring Cloud Bus는 동적으로 설정을 변경하고 이를 모든 마이크로서비스에 반영하기 위해 사용하는 **메시지 브로커 기반의 핸들러**이다.
- 동작 구조:
  - MQ(Message Queue)에 **Publisher(=Config Server)** 와 **Subscriber(=마이크로서비스)** 가 연결된다.
  - 설정 변경 정보를 MQ에 **Publish**한다.
  - 각 마이크로서비스는 **MQ로부터 알림을 받고**, 변경된 설정을 **Config Server로부터 다시 불러와 적용**한다.

## 2.1 Actuator bus-refresh Endpoint

- 분산 시스템의 노드를 **경량 메시지 브로커**(RabbitMQ, Kafka 등)와 연결한다.
- 설정 정보나 상태 변화 등의 변경 사항이 발생하면,
- `bus-refresh` Endpoint를 통해 해당 내용을 **브로커에 Publish**한다.
- 브로커는 메시지를 **연결된 모든 노드에 Broadcast**하여 설정 정보를 갱신하도록 전달한다.

## 3. AMQP(Advanced Message Queuing Protocol)

- **메시지 지향 미들웨어를 위한 개방형 표준 프로토콜**이다.
- **메시지 큐잉, 라우팅(P2P, Pub-Sub), 보안, 신뢰성** 등을 지원한다.
- Erlang 기반이며, 대표적으로 **RabbitMQ**에서 사용된다.

## 4. Kafka 프로젝트

- Apache Software Foundation에서 개발한 **오픈 소스 분산 메시지 브로커**이다.
- **대용량 데이터 처리에 최적화된 스트리밍 플랫폼**이다.
- 고속 처리와 확장성이 뛰어나며, **로그 수집, 실시간 분석, 이벤트 스트리밍 처리** 등에 사용된다.

## 5. RabbitMQ VS Kafka

- RabbitMQ
  - 메시지 브로커 역할을 수행한다.
  - 초당 20개 이상의 메시지를 안정적으로 소비자에게 전달한다.
  - 시스템 간 메시지 전달과 **메시지의 전달 보장**에 초점을 둔다.
  - **브로커 중심**, **소비자 기반 처리**에 적합하다.
- Kafka
  - 대용량 스트리밍 데이터 처리에 적합한 메시징 플랫폼이다.
  - 초당 **10만 건 이상의 이벤트를 처리할 수 있다**.
  - Topic 기반의 **Pub/Sub 구조**이며, **Ack를 기다리지 않고 빠르게 메시지를 전달**한다.
  - **생성자 중심**이며, 고속 처리와 로그 저장에 최적화되어 있다.
