# Microservice 패턴

## 1. Event Sourcing

- 데이터의 **최종 상태만 저장하는 것이 아니라**, 해당 데이터에 수행된 **모든 변경 이력(Event)을 기록**하는 방식이다.
- **데이터 구조가 단순**하며, 이벤트를 순서대로 재생하면 현재 상태를 재구성할 수 있다.
- **데이터 일관성과 트랜잭션 처리**가 가능하다.
- 데이터 저장소의 개체를 직접 업데이트하지 않기 때문에 **동시성 충돌 문제를 최소화**할 수 있다.
- **도메인 주도 설계(DDD)** 와 잘 어울린다.
  - Aggregate: 하나의 일관성 경계를 가진 도메인 객체 집합
  - Projection: 이벤트를 통해 조회에 최적화된 읽기 모델 생성
- **메시지 기반 비동기 처리** 구조에 적합하다.
- 단점:
  - 모든 이벤트를 재생하는 데 시간이 오래 걸릴 수 있어, **스냅샷**이 필요하다.
  - 다양한 형태의 조회 요구는 복잡할 수 있으므로, **CQRS 패턴과 함께 사용**하는 것이 일반적이다.

## 2. CQRS (Command and Query Responsibility Segregation)

- **명령(Command)** 과 **조회(Query)** 의 책임을 분리하는 패턴이다.
- Command: 상태를 변경하는 작업 (예: 주문 생성)
- Query: 데이터를 읽는 작업 (예: 주문 목록 조회)
- **성능 최적화와 확장성** 확보가 가능하며, 읽기/쓰기 모델을 각각 다른 저장소에 구성할 수도 있다.
- 복잡한 도메인에서는 Event Sourcing과 함께 자주 사용된다.

## 3. Saga Pattern

- **마이크로서비스 환경에서 분산 트랜잭션을 처리하기 위한 패턴**이다.
- 각 서비스는 **자신의 로컬 트랜잭션만 처리**하고, 결과를 이벤트로 전달한다.
- 두 가지 방식:
  - **Choreography**: 서비스 간 이벤트 기반으로 트랜잭션을 이어감 (중앙 조정자 없음)
  - **Orchestration**: 중앙 조정 서비스가 각 트랜잭션 호출을 제어
- 트랜잭션 실패 시 **보상 트랜잭션**을 통해 롤백 동작을 구현한다.
- **데이터 원자성은 보장하지 않지만, 전체적인 일관성을 보장**할 수 있다.
