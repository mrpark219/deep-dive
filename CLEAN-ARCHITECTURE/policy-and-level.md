# 정책과 수준

- **소프트웨어 시스템**이란 결국 **정책(Policy)**을 기술한 것이다.
- 컴퓨터 프로그램은 각 **입력**을 **출력**으로 변환하는 정책을 상세하게 기술한 설명서이다.
- 대다수의 주요 시스템에서 하나의 거대한 정책은, 이를 서술하는 여러 개의 **조그만 정책**들로 쪼갤 수 있다.

## 1. 정책의 분리와 재편성

- 소프트웨어 아키텍처를 개발하는 기술에는 이러한 정책을 신중하게 **분리**하고, 정책이 변경되는 양상에 따라 정책을 **재편성**하는 일이 포함된다.
- **동일한 이유**로 **동일한 시점**에 변경되는 정책은 **동일한 수준**에 위치하며, **동일한 컴포넌트**에 속해야 한다.
- **서로 다른 이유**로, 혹은 **다른 시점**에 변경되는 정책은 **다른 수준**에 위치하며 반드시 **다른 컴포넌트**로 분리해야 **한다**.

## 2. 비순환 방향 그래프 (DAG)

- 아키텍처 개발은 재편성된 컴포넌트들을 **비순환 방향 그래프(Directed Acyclic Graph: DAG)** 로 구성하는 기술을 포함한다.
  - 그래프에서 **정점(Node)** 은 동일한 수준의 정책을 포함하는 **컴포넌트**에 해당한다.
  - 방향이 있는 **간선(Edge)** 은 컴포넌트 사이의 **의존성**을 나타낸다.
  - **간선**은 **다른 수준**에 위치한 컴포넌트를 서로 연결한다.
- 이러한 의존성은 **소스 코드**, 즉 **컴파일 타임**의 의존성이다.

## 3. 의존성 규칙

- **좋은 아키텍처**라면 각 컴포넌트를 연결할 때 의존성의 방향이 컴포넌트의 **수준(Level)** 을 기반으로 연결되도록 만들어야 한다.
- 즉, **저수준 컴포넌트**가 **고수준 컴포넌트**에 **의존하도록** 설계되어야 한다.
  - 고수준 정책(핵심 업무 규칙)은 저수준 세부사항(DB, UI 등)의 변경에 영향을 받지 않아야 하기 때문이다.

## 4. 수준

- **수준(Level)** 은 **입력(Input)** 과 **출력(Output)** 까지의 **거리**를 의미한다.
- 시스템의 입력과 출력 모두로부터 **멀리** 위치할수록 정책의 수준은 **높아진다**.
- 반대로 **입력과 출력**을 직접 다루는 정책이라면 시스템에서 **최하위 수준**에 위치한다.

### 4.1. 의존성과 데이터 흐름

- **소스 코드 의존성**은 그 **수준**에 따라 결합되어야 한다.
  - 즉, **저수준** 정책이 **고수준** 정책을 바라봐야 한다.
- **데이터 흐름**을 기준으로 결합되어서는 **안 된다**.
  - 데이터는 고수준에서 저수준으로 흐를 수도 있지만, 의존성은 항상 **고수준(핵심)** 을 향해야 한다.

### 4.2. 정책의 변경 양상

- 정책을 컴포넌트로 묶는 기준은 정책이 **변경되는 방식**에 달려있다는 사실을 상기해야 한다.
- **단일 책임 원칙(SRP)** 과 **공통 폐쇄 원칙(CCP)** 에 따르면 **동일한 이유**로 **동일한 시점**에 변경되는 정책은 함께 묶인다.

#### 고수준 정책 (핵심 업무 규칙)

- 입력과 출력에서부터 **멀리** 떨어진 정책이다.
- 저수준 정책에 비해 **덜 빈번하게** 변경된다.
- 하지만 변경될 때는 **더 중요한 이유**(업무의 본질적 변화)로 변경되는 경향이 있다.

#### 저수준 정책 (세부 사항)

- 입력과 출력에 **가까이** 위치한 정책이다.
- 고수준 정책보다 **더 빈번하게** 변경된다.
- **보다 긴급성**을 요하며, **덜 중요한 이유**(UI 스타일 변경, DB 교체 등)로 변경되는 경향이 있다.
