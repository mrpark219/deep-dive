# 스레드 풀과 Executor 프레임워크2

## 1. 우아한 종료

- 만약 고객의 주문을 처리하는 서버를 기능 업데이트를 위해 재시작해야 한다고 가정한다.
- 이때, **고객의 주문이 처리되는 도중에 서버가 갑자기 재시작**된다면 해당 주문은 제대로 완료되지 못할 것이다.
- 가장 이상적인 방식은 **새로운 주문은 더 이상 받지 않고, 이미 진행 중인 주문은 모두 완료시킨 뒤에 서버를 재시작**하는 것이다.
- 이처럼 실행 중인 작업을 안전하게 마무리하고 시스템을 종료하는 방식을 **우아한 종료(Graceful Shutdown)**라고 한다.

## 2. ExecutorService의 종료 메서드

- `ExecutorService`는 우아한 종료를 위해 여러 가지 종료 관련 메서드를 제공한다.

### 2.1. 서비스 종료

- void shutdown()
  - **새로운 작업을 더 이상 받지 않고**, 작업 큐에 **이미 제출된 작업들이 모두 완료된 후에** 스레드 풀을 종료시킨다.
  - **논블로킹(Non-blocking)** 메서드로, 호출한 스레드는 즉시 다음 코드를 실행한다.
- List<Runnable> shutdownNow()
  - **즉시 스레드 풀을 종료**한다.
  - **실행 중인 작업에게는 인터럽트(interrupt) 신호**를 보내 중단을 시도하고, **작업 큐에서 대기 중이던 작업들의 목록을 반환**한다.
  - **논블로킹** 메서드이다.

### 2.2. 서비스 상태 확인

- boolean isShutdown()
  - `shutdown()`이나 `shutdownNow()`가 호출되어 **종료 절차가 시작되었는지** 여부를 확인한다.
- boolean isTerminated()
  - 종료 절차 시작 후, **모든 작업이 실제로 완료되어 스레드 풀이 완전히 종료되었는지** 여부를 확인한다.

### 2.3. 작업 완료 대기

- boolean awaitTermination(long timeout, TimeUnit unit) throws InterruptedException
  - `shutdown()` 호출 이후, **모든 작업이 완료될 때까지 지정된 시간 동안 대기**한다.
  - **블로킹(blocking)** 메서드이다.
  - 지정된 시간 내에 모든 작업이 완료되면 `true`를, 시간이 초과되어도 완료되지 않으면 `false`를 반환한다.

### 2.4. close()

- 자바 19부터 지원하는 메서드로, **`shutdown()`과 동일하게 동작**한다.
- 더 정확하게는, `shutdown()`을 호출하고 **하루를 기다려도 작업이 완료되지 않으면 `shutdownNow()`를 호출**한다.
- 또한, `close()`를 호출한 스레드에 인터럽트가 발생해도 `shutdownNow()`를 호출한다.
